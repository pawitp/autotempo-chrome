<!doctype html>
<html data-ng-app="autoTempoApp" lang="en">
<head>
  <meta charset="utf-8">
  <title>AutoTempo</title>

  <!-- build:css styles/vendor.css -->
  <link rel="stylesheet" href="bower_components/angular/angular-csp.css">
  <link rel="stylesheet" href="bower_components/angular-bootstrap/ui-bootstrap-csp.css">
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
  <!-- bower:css -->
  <!-- endbower -->
  <!-- endbuild -->

  <!-- build:css styles/main.css -->
  <link rel="stylesheet" href="styles/main.css">
  <!-- endbuild -->
</head>
<body data-ng-controller="AppController" data-ng-cloak>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <uib-tabset>
        <uib-tab heading="Log from Exchange">
          <h3>Appointments <small class="pull-right"><input type="date" data-ng-model="exchangeLog.inputDate" data-ng-change="fetchAppointments()"></small></h3>
          <table class="table table-condensed">
            <tr>
              <th>Subject</th>
              <th>Start</th>
              <th>End</th>
              <th>Duration</th>
              <th>My Response Type</th>
              <th>Log as</th>
            </tr>
            <tr data-ng-repeat="appointment in appointments">
              <td>{{ appointment.subject }}</td>
              <td>{{ appointment.start | date: "HH:mm" }}</td>
              <td>{{ appointment.end | date: "HH:mm" }}</td>
              <td>{{ (appointment.end - appointment.start) / 3600000 | number: 2 }} h</td>
              <td>{{ appointment.myResponseType }}</td>
              <td>
                <select class="form-control"
                        data-ng-init="appointment.logType = logTypes[0]"
                        data-ng-options="type.name for type in logTypes track by type.name"
                        data-ng-model="appointment.logType"></select>
              </td>
            </tr>
          </table>
          <hr>
          <button data-ng-click="submitTempo()" class="btn btn-primary">Log to tempo!</button>
        </uib-tab>
        <uib-tab heading="Quick Log">
          <div class="row">
            <div class="col-md-12">
              <div class="alert alert-warning" role="alert">Under Construction</div>
            </div>
          </div>
        </uib-tab>
        <uib-tab heading="Configuration">
          <!-- TODO: Configuration Helper (at least URL format) -->
          <div class="row">
            <div class="col-md-12">
              <h3>Credentials</h3>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <h4>Exchange</h4>
              <div class="form-group">
                <label for="exchangeUrl">URL</label>
                <input type="text" class="form-control" id="exchangeUrl" data-ng-model="config.exchange.url">
              </div>
              <div class="checkbox">
                <label><input type="checkbox" data-ng-model="config.exchange.spnego">Use domain authentication</label>
              </div>
              <div data-ng-show="!config.exchange.spnego">
                <div class="form-group">
                  <label for="exchangeUsername">Username</label>
                  <input type="text" class="form-control" id="exchangeUsername" data-ng-model="config.exchange.username">
                </div>
                <div class="form-group">
                  <label for="exchangePassword">Password</label>
                  <input type="password" class="form-control" id="exchangePassword" data-ng-model="config.exchange.password">
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <h4>JIRA/Tempo</h4>
              <div class="form-group">
                <label for="jiraUrl">URL</label>
                <input type="text" class="form-control" id="jiraUrl" data-ng-model="config.jira.url">
              </div>
              <div class="form-group">
                <label for="jiraUsername">Username</label>
                <input type="text" class="form-control" id="jiraUsername" data-ng-model="config.jira.username">
              </div>
              <div class="form-group">
                <label for="jiraPassword">Password</label>
                <input type="password" class="form-control" id="jiraPassword" data-ng-model="config.jira.password">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <h3>Log Types</h3>
              <table class="table table-condensed">
                <tr>
                  <th>Name</th>
                  <th>Issue Key</th>
                  <th>Account Key</th>
                  <th></th>
                </tr>
                <!-- TODO: Validation, no same name -->
                <tr data-ng-repeat="logType in config.logTypes">
                  <td><input type="text" data-ng-model="logType.name" class="form-control"></td>
                  <td><input type="text" data-ng-model="logType.issueKey" class="form-control"></td>
                  <td><input type="text" data-ng-model="logType.accountKey" class="form-control"></td>
                  <td><button data-ng-click="deleteLogType($index)" class="btn btn-danger">&times;</button></td>
                </tr>
              </table>
              <button data-ng-click="saveConfig()" class="btn btn-primary">Save</button>
              <button data-ng-click="addLogType()" class="btn btn-default">Add new log type</button>
              <p>{{ configStatus }}</p>
            </div>
          </div>
        </uib-tab>
      </uib-tabset>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <h2>Results</h2>
      <ul data-ng-repeat="result in results">
        <li>Logging "{{ result.subject }}" as {{ result.issueKey }} account {{ result.accountKey }} for {{ result.duration / 3600000 | number : 2}} h: {{ result.status }}</li>
      </ul>
    </div>
  </div>

</div>

<!-- build:js scripts/vendor.js -->
<!-- bower:js -->
<script src="bower_components/angular/angular.js"></script>
<script src="bower_components/angular-bootstrap/ui-bootstrap-tpls.js"></script>
<!-- endbower -->
<!-- endbuild -->

<!-- build:js scripts/main.js -->
<script src="scripts/app.js"></script>
<script src="scripts/utils.js"></script>
<script src="scripts/configService.js"></script>
<script src="scripts/exchangeService.js"></script>
<script src="scripts/jiraService.js"></script>
<!-- endbuild -->
</body>
</html>
